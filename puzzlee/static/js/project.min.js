function search_for_artist(e,t){const o=t.filter((t=>t[0].toLowerCase().search(e.toLowerCase())>-1));return o.length>0?o.sort((t=>t[0].toLowerCase().search(e.toLowerCase()))):[]}function autocomplete(e,t){var o;function n(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),o>=e.length&&(o=0),o<0&&(o=e.length-1),e.length>0&&e[o].classList.add("autocomplete-active")}function a(t){for(var o=document.getElementsByClassName("autocomplete-items"),n=0;n<o.length;n++)t!=o[n]&&t!=e&&o[n].parentNode.removeChild(o[n])}e.addEventListener("input",(function(s){var l,c,r;if(r=this.value,a(),!r)return!1;o=-1;let d=search_for_artist(r,t);(l=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),l.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(l),console.log(d),d.map((t=>{c=document.createElement("div");let o=new RegExp(r,"gi");res=t[0].replace(o,(e=>`<strong>${e}</strong>`)),c.innerHTML=res,c.innerHTML+=`<input type='hidden' value='${JSON.stringify(t)}'>`,c.addEventListener("click",(function(t){selected=JSON.parse(this.getElementsByTagName("input")[0].value),e.value=selected[0],answer_input=document.getElementById("id_artist_answer"),answer_input.value=selected[1],a()})),l.appendChild(c)})),x=document.getElementById(this.id+"autocomplete-list"),console.log(x),x&&(ac_list=x.getElementsByTagName("div"),o=0,n(ac_list))})),e.addEventListener("keydown",(function(e){let t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),"ArrowDown"===e.code?(o++,n(t)):"ArrowUp"===e.code?(o--,n(t)):"Enter"===e.code&&(e.preventDefault(),o>-1&&t&&t[o].click())})),document.addEventListener("click",(function(e){a(e.target)}))}const ale=document.getElementById("artist_list");if(ale){const e=JSON.parse(ale.textContent);artist_div=document.getElementById("div_id_artist_fullname"),artist_div.classList.add("autocomplete"),artist_input=document.getElementById("id_artist_fullname"),autocomplete(artist_input,e)}const APPROVAL_OPTIONS={rejected:0,unset:1,approved:2};function updateCard(e,t){let o=document.getElementById(`dp_col_${e}`);switch(t){case APPROVAL_OPTIONS.rejected:o.innerHTML="<p>Moved to rejected</p>";break;case APPROVAL_OPTIONS.unset:o.innerHTML="<p>Moved to unset</p>";break;case APPROVAL_OPTIONS.approved:o.innerHTML="<p>Moved to approved</p>"}}function setStatus(e,t){const o=document.querySelector("input[name=csrfmiddlewaretoken]").value,n={detailpage:e,approved:t};fetch(SET_STATUS_ENDPOINT,{method:"post",headers:{"Content-Type":"application/json","X-CSRFToken":o,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(n)}).then((e=>(console.log(e),e.json()))).then((o=>{console.log(o),"success"===o.status?(console.log("success"),updateCard(e,t)):console.log(o.message)})).catch((e=>{console.log(e)}))}function showEnlarged(e,t){const o=new bootstrap.Modal(document.getElementById("enlargedModal"));document.getElementById("enlargedImage").setAttribute("src",t);document.getElementById("enlargedModalTitle").textContent=e,o.show(),console.log(t)}function showApprovalForm(e,t,o,n){const a=new bootstrap.Modal(document.getElementById("approvalModal"));console.log(a);const s=document.getElementById("id_detailpage"),l=o.split(" ").slice(-1)[0];s.value=e;const c=document.getElementById("id_artist_fullname");console.log(o),console.log(c),c.value=o;const r=document.getElementById("id_title");console.log(r),console.log(t),r.value=t;const d=document.getElementById("id_artist_answer");console.log(d),console.log(l),d.value=l;const i=document.getElementById("id_approval_image");console.log(i),console.log(n),i.setAttribute("src",n),a.show()}async function submitApprovalForm(e){e.preventDefault();const t=document.querySelector("form#id_approval_form > input[name=csrfmiddlewaretoken]").value,o=document.getElementById("id_approval_form"),n=new FormData(o),a=Object.fromEntries(n.entries());console.log(a);const s=await fetch(APPROVAL_ENDPOINT,{method:"post",headers:{"Content-Type":"application/json","X-CSRFToken":t,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(a)}),l=await s.json();if("success"===l.status){updateCard(a.detailpage,APPROVAL_OPTIONS.approved);bootstrap.Modal.getInstance(document.getElementById("approvalModal")).hide()}else if("error"===l.status){document.getElementById("approval_form_errors").innerHTML=`<p>${l.message}</p>`}else console.log(l)}const approvalForm=document.getElementById("id_approval_form");approvalForm&&(approvalForm.onsubmit=submitApprovalForm);